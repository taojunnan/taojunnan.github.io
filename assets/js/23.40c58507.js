(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{554:function(t,s,a){"use strict";a.r(s);var e=a(10),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("本文是对已经在"),a("code",[t._v("Jenkins")]),t._v("中已建好的项目的使用说明。不包含如何一些"),a("code",[t._v("Jenkins")]),t._v("的基础使用技巧。"),a("br"),t._v("\n我这里部署好了两个项目，是一个前后端分离项目的前台(Vue)和后台(Spring boot)。"),a("br"),t._v(" "),a("code",[t._v("Jenkins")]),t._v("运行在"),a("code",[t._v("Windows")]),t._v("，远程服务器为"),a("code",[t._v("Windows")])]),t._v(" "),a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("h3",{attrs:{id:"安装freesshd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装freesshd"}},[t._v("#")]),t._v(" 安装FreeSSHd")]),t._v(" "),a("p",[t._v("在你需要远程部署的服务器上安装FreeSSHd，它是跟待部署的服务器之间通信用的，不然无法完成远程部署，"),a("a",{attrs:{href:"http://www.freesshd.com/freeSSHd.exe",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载地址"),a("OutboundLink")],1),t._v("。安装过程一路next，直到完成。")]),t._v(" "),a("p",[t._v("以管理员身份运行，打开后找到"),a("code",[t._v("Users")]),t._v("选项卡，点击"),a("code",[t._v("Add")]),t._v("按钮，新建一个用户，如下图，请牢记用户名和密码后面用得到。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/cP2vywhSsu5IXGQ.png",alt:"image-20200416150838238"}})]),t._v(" "),a("p",[t._v("打开"),a("code",[t._v("SFTP")]),t._v("选项卡，选择"),a("code",[t._v("SFTP")]),t._v("根目录，表示后面远程传递过来的文件都在此目录下，我这里用的路径为"),a("code",[t._v("C:\\ftpfile")]),t._v("，当然你也可以随意替换，但是下文中所有出现这个路径的地方请自行替换成自己的路径。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/F9XUkoyLfR7MvQu.png",alt:"image-20200416151835305"}})]),t._v(" "),a("p",[t._v("打开"),a("code",[t._v("SSH")]),t._v("选项卡，"),a("s",[t._v("选择"),a("code",[t._v("listen address")]),t._v("为服务器本机IP，取消勾选"),a("code",[t._v("Start SSH server on freeSSHd startup")])]),t._v("（非必须，我自己配置多台服务器的过程中发现只要默认就可以连接上，改成本机IP反而连不上，这时你才去改成默认地址即"),a("code",[t._v("0.0.0.0")]),t._v("还是不能连上，我的做法是卸载重装，直接默认即可）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/6VzUwY1Z24EpqxR.png",alt:"image-20200416153701835"}})]),t._v(" "),a("p",[t._v("打开"),a("code",[t._v("Server status")]),t._v("选项卡，点击"),a("code",[t._v("Click here to start it")]),t._v("打开"),a("code",[t._v("SSH server")]),t._v("，不然就连不上服务器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/bRj3AKp4Cu2ohYx.png",alt:"image-20200416152314560"}})]),t._v(" "),a("h3",{attrs:{id:"远程服务器端必要文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#远程服务器端必要文件"}},[t._v("#")]),t._v(" 远程服务器端必要文件")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("C:\\ftpfile")]),t._v("下准备两个"),a("code",[t._v(".bat")]),t._v("文件，分别为"),a("code",[t._v("front.bat")]),t._v("，"),a("code",[t._v("back.bat")]),t._v("，主要功能就是在远程打包过来后做的一些处理，比如重新启动前后台服务。(另一个文件"),a("code",[t._v("IPConfig.js")]),t._v("是一个配置文件，配置不同服务器上请求的IP地址，用来替换掉原项目中的配置文件，可忽略)")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/W9yLlUrbDEpJ2ZH.png",alt:"image-20200416160924716"}})]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" front"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::将tomcat原项目删掉\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rmdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("q C:\\tomcat8\\webapps\\nm5700v3\n::将发送过来的文件及文件夹复制到tomcat目录\nxcopy C:\\ftpfile\\NM5700Web C:\\tomcat8\\webapps\\nm5700v3\\ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("y\n::替换TPConfig文件\nxcopy C:\\ftpfile\\IPConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js C:\\tomcat8\\webapps\\nm5700v3\\static\\ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("y\n::关闭tomcat\ncmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("c C:\\tomcat8\\bin\\shutdown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::重新启动tomcat\ncmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("c C:\\tomcat8\\bin\\startup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::将从jenkins传输过来存放项目内容的临时文件夹删掉\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rmdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("q C:\\ftpfile\\NM5700Web\n")])])]),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" back"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::将发送过来的文件复制到server目录\nxcopy C:\\ftpfile\\NM5700EServer C:\\server\\ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("y\n::先关闭后台服务\ncmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("c C:\\server\\shutdown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::将原后台jar包删掉\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),t._v(" C:\\server\\server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\n::重命名新jar包为server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\nrename C:\\server\\nm5700eserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\n::重新启动后台服务\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" cmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("c C:\\server\\startup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bat\n::将远程传输过来存放项目内容的临时文件夹删掉\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rmdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("q C:\\ftpfile\\NM5700EServer\n")])])]),a("p",[a("strong",[t._v("附一个在Windows上通过端口号关闭进程的批处理文件")])]),t._v(" "),a("blockquote",[a("p",[t._v("使用时，把"),a("code",[t._v("8080")]),t._v("替换成实际端口号即可")])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" off&setlocal EnableDelayedExpansion  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" Port=\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" Dstport=8080\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("F "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"usebackq skip=4 tokens=2,5"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("a in "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"netstat -ano -p tcp"')]),t._v("`"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("F "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens=2 delims=:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("k in "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%%a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v("  Port="),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("k  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("Port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("b >>portandpid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("F "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens=2 delims=:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("c in "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v("  Port="),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("c  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("F "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens=1,2 delims= "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d in "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("portandpid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d   \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Dstport"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d == "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Dstport"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" taskkill "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("e  \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),t._v(" portandpid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt    \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" Port=  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" Dstport=  \ngoto :eof  \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'结束了'")]),t._v("\npause\n")])])]),a("h2",{attrs:{id:"开始部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始部署"}},[t._v("#")]),t._v(" 开始部署")]),t._v(" "),a("h3",{attrs:{id:"jenkins增加服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins增加服务器"}},[t._v("#")]),t._v(" Jenkins增加服务器")]),t._v(" "),a("p",[t._v("进入"),a("code",[t._v("Configure System")]),t._v("系统配置页面，找到"),a("code",[t._v("Publish over SSH -> SSH Servers")]),t._v(" ，点击"),a("code",[t._v("新增")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/UThmIl1dk2CuzrR.png",alt:"image-20200416163301979"}})]),t._v(" "),a("p",[t._v("配置完之后点击"),a("code",[t._v("Test Configuration")]),t._v("按钮，测试是否连通。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/lswiu9RJzeQDZxM.png",alt:"image-20200416163415115"}})]),t._v(" "),a("h3",{attrs:{id:"项目中添加要部署的服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目中添加要部署的服务器"}},[t._v("#")]),t._v(" 项目中添加要部署的服务器")]),t._v(" "),a("p",[t._v("在项目配置中，找到"),a("code",[t._v("构建后操作")]),t._v(",选择"),a("code",[t._v("Send build artifacts over SSH")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/GzoEsT15FPflCy7.png",alt:"image-20200416164432529"}})]),t._v(" "),a("p",[t._v("前台vue项目的配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/9RKq5kirNgVDfoP.png",alt:"image-20200416165154396"}})]),t._v(" "),a("p",[t._v("后台Spring boot项目的配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/16/2bEjIC7xGKz6Foe.png",alt:"image-20200416165538981"}})]),t._v(" "),a("h2",{attrs:{id:"运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),a("p",[t._v("构建项目查看效果")]),t._v(" "),a("h2",{attrs:{id:"faq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[t._v("#")]),t._v(" FAQ")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("从"),a("code",[t._v("svn")]),t._v("拉取构建的代码不是最新的？")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("Jenkins")]),t._v("服务器时间和"),a("code",[t._v("svn")]),t._v("服务器之间的时间不同步，拉取的代码可能不是最新的，此时应该在"),a("code",[t._v("svn URL")]),t._v("后加上"),a("code",[t._v("@HEAD")]),t._v("表示每次部署时拉取的都是最新代码，如"),a("code",[t._v("127.0.0.1/test@HEAD")])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);